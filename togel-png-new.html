<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kalkulator Hadiah Togel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables */
        :root {
            --warnabutton_hitung: #4CAF50;
            --shadowbutton_hitung: #388E3C;
            --warnabutton_reset: #FFD700;
            --shadowbutton_reset: #FFC400;
            --warnaborder_card: linear-gradient(135deg, rgba(102, 0, 0, 0.8), rgba(153, 0, 0, 0.8));
            --warnabackground_card: linear-gradient(135deg, rgba(102, 0, 0, 0.8), rgba(153, 0, 0, 0.8));
            --borderbutton_atas: #0099ff;
            --primary-color: #FFD700;
            --secondary-color: #0a1d46;
            --accent-color: #ffcc00;
            --text-color: #fff;
            --background-dark: rgba(10, 29, 70, 0.95);
        }

        /* Basic Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: url('https://cdn.areabermain.club/assets/cdn/az9/2023/12/16/20231216/f82bd18f48850e4f1b12b30900ad2efe/TVTOTO_BG_RTP_0.jpg') center/cover no-repeat fixed;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin: 20px 0 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
            border: 3px solid #FFD700;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #1a1a1a;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 2px;
            margin: 0;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
        }

        .header .subtitle {
            font-size: 1rem;
            color: #2c2c2c;
            margin-top: 5px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Market Box */
        .market-box {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--secondary-color);
            border: 2px solid var(--accent-color);
            color: #ffd773;
            padding: 8px 20px;
            border-radius: 12px;
            font-weight: 900;
            letter-spacing: .2px;
            text-transform: uppercase;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .market-logo {
            width: 160px;
            height: 48px;
            object-fit: contain;
            background: var(--secondary-color);
            padding: 4px;
            border-radius: 6px;
            display: block;
        }

        /* Sticky Bar */
        .dhp-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--background-dark);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 15px 0;
        }

        .dhp-bar-inner {
            display: flex;
            flex-direction: row;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        .dhp-title {
            font-weight: 900;
            letter-spacing: .3px;
            color: var(--primary-color);
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .dhp-select {
            height: 44px;
            border-radius: 12px;
            border: 2px solid var(--accent-color);
            background: var(--secondary-color);
            color: var(--text-color);
            padding: 0 14px;
            font-weight: 800;
            letter-spacing: .25px;
            outline: none;
            text-transform: uppercase;
            width: 100%;
            max-width: 320px;
            cursor: pointer;
        }

        /* Yellow Line */
        .dhp-line {
            width: 100%;
            height: 3px;
            background: var(--accent-color);
            margin: 12px 0 0;
            border-radius: 2px;
        }

        /* Info Section */
        .dhp-info {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        /* Tabs */
        .dhp-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .dhp-tab {
            appearance: none;
            border-radius: 999px;
            padding: 10px 16px;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            background: linear-gradient(135deg, rgba(102, 0, 0, 0.8), rgba(153, 0, 0, 0.8));
            color: var(--accent-color);
            border: 2px solid rgba(255,189,0,.65);
            box-shadow: 0 2px 0 rgba(0,0,0,.25);
            transition: all 0.3s ease;
        }

        .dhp-tab:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .dhp-tab.active {
            background: linear-gradient(135deg, rgba(153, 0, 0, 0.9), rgba(204, 0, 0, 0.9));
            color: var(--primary-color);
            border-color: var(--accent-color);
            box-shadow: 0 4px 8px rgba(0,0,0,.3);
        }

        /* Grid */
        .dhp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        /* Cards */
        .dhp-card {
            background: var(--warnabackground_card);
            border: 2px solid;
            border-image: var(--warnaborder_card);
            border-image-slice: 0;
            border-radius: 14px;
            backdrop-filter: blur(4px);
            box-shadow: 0 10px 24px rgba(0,0,0,.35);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .dhp-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 14px 28px rgba(0,0,0,.45);
        }

        .dhp-card-header {
            flex: 0 0 auto;
        }

        .dhp-card-content {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .dhp-card-footer {
            flex: 0 0 auto;
        }

        .dhp-card h3 {
            margin: 0;
            font-size: 16px;
            letter-spacing: .35px;
            text-transform: uppercase;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
            text-align: center;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .dhp-card h3.dhp-small-title {
            font-size: 14px;
            line-height: 1.25;
        }

        .dhp-meta {
            font-weight: 700;
            color: var(--text-color);
            opacity: .95;
            text-align: center;
            font-size: 14px;
        }

        .dhp-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .dhp-row input {
            width: 100%;
            border-radius: 10px;
            border: 2px solid var(--primary-color);
            background: #e9f0ff;
            color: #10203f;
            height: 44px;
            padding: 10px 12px;
            font-weight: 800;
            text-align: center;
            outline: none;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dhp-row input::placeholder {
            color: #627aa8;
            opacity: .95;
        }

        .dhp-row input:focus {
            box-shadow: 0 0 0 3px rgba(255,189,0,.25);
        }

        /* Actions */
        .dhp-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        .dhp-btn {
            height: 42px;
            border-radius: 10px;
            border: 0;
            font-weight: 900;
            letter-spacing: .2px;
            color: #111;
            cursor: pointer;
            padding: 0 12px;
            width: 100%;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .dhp-btn:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
        }

        .dhp-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .dhp-btn.dhp-hitung {
            background: linear-gradient(180deg, var(--warnabutton_hitung), var(--shadowbutton_hitung));
            box-shadow: 0 4px 0 #2E7D32;
        }

        .dhp-btn.dhp-reset {
            background: linear-gradient(180deg, var(--warnabutton_reset), var(--shadowbutton_reset));
            box-shadow: 0 4px 0 #FF8F00;
        }

        /* Output */
        .dhp-out {
            display: none;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .dhp-out.show {
            display: grid;
        }

        .dhp-pill {
            border: 1px dashed rgba(255,255,255,.25);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            font-weight: 700;
            background: rgba(255,255,255,.08);
            font-size: 14px;
            line-height: 1.4;
        }

        .dhp-pay { color: #ffcc00; }
        .dhp-win { color: #ffcc00; }
        .dhp-sum { color: #ffcc00; }
        .dhp-min { color: #ffcc00; }

        /* Divider */
        .dhp-divider {
            grid-column: 1/-1;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 30px 0 20px;
        }

        .dhp-divider:before,
        .dhp-divider:after {
            content: "";
            flex: 1000;
            border-bottom: 2px solid var(--primary-color);
        }

        .dhp-divider-label {
            display: inline-block;
            padding: 8px 18px;
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            background: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 900;
            font-size: 18px;
            letter-spacing: .3px;
            line-height: 1;
            white-space: nowrap;
        }

        /* Empty State */
        .dhp-empty {
            margin: 30px auto;
            padding: 20px;
            color: var(--primary-color);
            opacity: .95;
            text-align: center;
            border: 2px dashed var(--primary-color);
            border-radius: 12px;
            background: rgba(0,0,0,.35);
            font-size: 18px;
            font-weight: 700;
        }

        /* Small calculation table per card */
        .card-calc-table {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            font-size: 14px;
            display: none;
        }

        .card-calc-table.show {
            display: block;
        }

        .card-calc-table h4 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 16px;
            text-align: center;
            font-weight: 700;
        }

        .calc-step {
            margin: 8px 0;
            color: var(--text-color);
            line-height: 1.4;
        }

        .calc-step .formula {
            color: var(--accent-color);
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .calc-step .result {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: var(--primary-color);
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid var(--primary-color);
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
                letter-spacing: 1px;
            }

            .header {
                margin: 15px 0 20px;
                padding: 15px;
            }

            .dhp-tabs {
                gap: 8px;
            }

            .dhp-tab {
                padding: 8px 12px;
                font-size: 12px;
            }

            .dhp-grid {
                grid-template-columns: 1fr;
            }

            .dhp-divider-label {
                font-size: 16px;
                padding: 6px 14px;
            }
        }

        @media (max-width: 480px) {
            .dhp-bar-inner {
                flex-direction: column;
                gap: 10px;
            }
            
            .dhp-select {
                max-width: 100%;
            }
            
            .dhp-actions {
                grid-template-columns: 1fr;
            }
            
            .market-box {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background: var(--secondary-color);
            color: var(--text-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left: 4px solid #ff4d4d;
        }

        .notification.success {
            border-left: 4px solid var(--warnabutton_hitung);
        }

        .notification.warning {
            border-left: 4px solid var(--warnabutton_reset);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>KALKULATOR HADIAH TOGEL</h1>
            <div class="subtitle">Hitung Hadiah & Diskon Semua Pasaran</div>
        </div>

        <div id="dhp-embed"></div>
    </div>

    <div class="footer">
        &copy; 2023 Kalkulator Hadiah Togel - Semua hak dilindungi
    </div>

    <script>
        (() => {
            'use strict';

            // Error handler function
            function fatal(msg) {
                try {
                    console.error('[DHP]', msg);
                    showNotification('Error: ' + msg, 'error');
                } catch {}
            }

            // Show notification
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icon = document.createElement('i');
                if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                } else if (type === 'success') {
                    icon.className = 'fas fa-check-circle';
                } else if (type === 'warning') {
                    icon.className = 'fas fa-exclamation-triangle';
                } else {
                    icon.className = 'fas fa-info-circle';
                }
                
                const text = document.createElement('span');
                text.textContent = message;
                
                notification.appendChild(icon);
                notification.appendChild(text);
                document.body.appendChild(notification);
                
                // Show notification
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // Hide after 5 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 5000);
            }

            try {
                // Initialize DOM elements
                const host = document.getElementById('dhp-embed');
                if (!host) {
                    fatal('Tidak menemukan #dhp-embed');
                    return;
                }

                // Utility functions
                const $ = (s, r) => (r || document).querySelector(s);
                const $$ = (s, r) => [].slice.call((r || document).querySelectorAll(s));
                const norm = s => String(s || '').replace(/\s+/g, ' ').trim().toLowerCase();
                const idr = n => Number(n || 0).toLocaleString('id-ID');

                // Safe localStorage
                const safeStore = (() => {
                    try {
                        localStorage.setItem('__dhp__', '1');
                        localStorage.removeItem('__dhp__');
                        return localStorage;
                    } catch {
                        return {
                            getItem() { return ''; },
                            setItem() {}
                        };
                    }
                })();

                // Market logos configuration
                const MARKET_LOGOS = {
                    'HOKI DRAW': 'https://cdn.areabermain.club/assets/cdn/az4/2024/12/25/20241225/1de5162dbfea7a85f41b654a2c3a4d07/logo-1.png',
                    'BANGKOK': 'https://bangkokpoolstoday.com/assets/img/bangkokpools_logo.png',
                    'BRUNEI': 'https://bruneipools.com/assets/img/brunei-logo.png',
                    'BULLSEYE': 'https://cdn.areabermain.club/assets/cdn/az4/2024/08/11/20240811/f07d4e2a6517ef1cea9e2a897e4abb98/nz-bullseye.png',
                    'CALIFORNIA': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/c89c3a35f7323e90e2e2c5c255bdb7ae/california-pools-jpg.png',
                    'CAROLINA DAY': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/816329e82e136b1e9faad6d14c8c81bc/carolina-day-pools-jpg.png',
                    'CAROLINA EVE': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/799cce2ab08aca8bfb3a4a9c7484d78e/carolina-eve-jpg.png',
                    'CHELSEA': 'https://chelseapools.co.uk/assets/img/chelseaPools_logo.png',
                    'FLORIDA EVE': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/801479ca02e15020fac8df0024814152/florida-eve-new-2.png',
                    'FLORIDA MID': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/1ffa2459adcc8330fa8874792d59eb1a/florida-mid.png',
                    'HONGKONG': 'https://cdn.animaapp.com/projects/66be29ddeca4d2e95aa7b4ce/releases/66be3e204d8f7eb28bb5de15/img/hongkong-lotto-1.png',
                    'HUAHIN': 'https://huahinlottery.com/assets/img/logo.png',
                    'KENTUCKY EVE': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/ae8e720c8b7d930856cf3f364cc10158/kentucky-eve.png',
                    'KENTUCKY MID': 'https://kentuckymid.com/wp-content/uploads/2022/07/KENTUCKY-MID.png',
                    'MAGNUM4D': 'https://cdn.areabermain.club/assets/cdn/az4/2024/08/11/20240811/8889f1c5fc738b5148145100c08a0ebc/439-4390693-magnum-pengeluaran-magnum-4d-hari-clipart-removebg-preview.png',
                    'NEVADA': 'https://www.nevadalottery.us/images/logo.gif',
                    'NEW YORK EVE': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/1f9a654060201e07442bc78def1bc135/new-york-eve.png',
                    'NEW YORK MID': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/7fb415d09885f1a79bfc30b48803cc4d/new-york-mid.png',
                    'OREGON': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/7715823646164db9d67d280a402dfb51/oregon-jpg.png',
                    'PCSO': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/a67d9fd134f7211cbe08bd89bd64f79d/pcso-2.png',
                    'POIPET': 'https://poipetlottery.com/img/logo.png',
                    'SINGAPORE': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/ae20d56fcb2d0dea6b0ae637c6bed566/singapore-new.png',
                    'SYDNEY': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/1d9ba1f974240b7b5c5e48fa2ef98e0e/sydney-2.png',
                    'TOTOMALI': 'https://cdn.areabermain.club/assets/cdn/az8/2025/08/18/20250818/383a30e8a8e65f1d0da9fb7fa850d853/channels4-banner.png',
                    'TOTO MACAU 4D': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/033094b5e73f842fcbcc3b235c029e7c/macau-logo.png',
                    'KINGKONG': 'https://cdn.areabermain.club/assets/cdn/az4/2025/08/18/20250818/32f87d6c932b0d2eee9b6e1c9028ab41/logo-2.png',
                    'TOTO CAMBODIA': 'https://totocambodialive.com/assets/img/logo.png'
                };

                // Create main wrapper
                const wrap = document.createElement('div');
                wrap.className = 'dhp-wrap';

                // Create top bar with market selector
                const bar = document.createElement('div');
                bar.className = 'dhp-bar';

                const barIn = document.createElement('div');
                barIn.className = 'dhp-bar-inner';

                const ttl = document.createElement('div');
                ttl.className = 'dhp-title';
                ttl.innerHTML = '<i class="fas fa-list-ul"></i> PILIH PASARAN TOGEL:';

                const sel = document.createElement('select');
                sel.id = 'dhp-sel';
                sel.className = 'dhp-select';
                sel.setAttribute('aria-label', 'Pilih pasaran');

                // Default option
                const opt0 = document.createElement('option');
                opt0.value = '';
                opt0.disabled = true;
                opt0.selected = true;
                opt0.textContent = 'PILIH PASARAN';
                sel.appendChild(opt0);

                // Market options
                const markets = [
                    'TOTO MACAU 4D', 'KINGKONG', 'BANGKOK', 'BRUNEI',
                    'CHELSEA', 'HONGKONG', 'HUAHIN', 'MAGNUM4D', 'NEVADA', 'POIPET',
                    'SYDNEY', 'TOTO CAMBODIA', 'BULLSEYE', 'CALIFORNIA', 'CAROLINA EVE',
                    'CAROLINA DAY', 'FLORIDA EVE', 'FLORIDA MID', 'KENTUCKY EVE',
                    'KENTUCKY MID', 'NEW YORK EVE', 'NEW YORK MID', 'OREGON', 'PCSO',
                    'SINGAPORE', 'HOKI DRAW', 'TOTOMALI'
                ];

                markets.forEach(market => {
                    const option = document.createElement('option');
                    option.value = market;
                    option.textContent = market;
                    sel.appendChild(option);
                });

                barIn.append(ttl, sel);
                bar.appendChild(barIn);
                wrap.appendChild(bar);

                // Yellow line
                const yellowLine = document.createElement('div');
                yellowLine.className = 'dhp-line';
                wrap.appendChild(yellowLine);

                // Info section
                const info = document.createElement('div');
                info.id = 'dhp-info';
                info.className = 'dhp-info';
                wrap.appendChild(info);

                // Tabs
                const tabs = document.createElement('div');
                tabs.className = 'dhp-tabs';

                const makeTab = (key, text, active = false) => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'dhp-tab' + (active ? ' active' : '');
                    button.dataset.k = key;
                    button.textContent = text;
                    return button;
                };

                tabs.append(
                    makeTab('all', 'SEMUA', true),
                    makeTab('diskon', 'DISKON'),
                    makeTab('betfull', 'BET FULL'),
                    makeTab('prize', 'PRIZE 123'),
                    makeTab('tepatbb', 'TEPAT & BB'),
                    makeTab('lain', 'LAINNYA')
                );
                wrap.appendChild(tabs);

                // Grid container
                const grid = document.createElement('div');
                grid.id = 'dhp-grid';
                grid.className = 'dhp-grid';

                // Empty state
                const empty = document.createElement('div');
                empty.id = 'dhp-empty';
                empty.className = 'dhp-empty';
                empty.style.display = 'none';
                empty.textContent = 'Silakan pilih pasaran terlebih dahulu.';

                wrap.append(grid, empty);
                host.appendChild(wrap);

                // Game configuration constants
                const KEI_MINUS = {
                    'silang homo': 1,
                    '50 - 50': 1,
                    'tengah tepi': 1,
                    'kembang - kempis - kembar': 1,
                    'dasar ganjil - besar': 1
                };

                const KEI_PLUS = {
                    'dasar genap - kecil': 1
                };

                // Utility functions for game logic
                const isPlusTotal = title => {
                    const t = norm(title);
                    return /^colok bebas(\s*\(\s*\d+\s*\))?$/.test(t) ||
                           /^colok bebas 2d/.test(t) ||
                           /^colok befas 4d/.test(t) ||
                           /^colok jitu/.test(t) ||
                           /^colok naga/.test(t) ||
                           /^shio$/.test(t) ||
                           /^kombinasi$/.test(t);
                };

                const isMin1000 = t => {
                    const min1000Games = {
                        'colok bebas': 1, 'colok bebas 2d': 1, 'colok bebas 4d': 1,
                        'colok naga': 1, 'colok jitu': 1,  'shio': 1,
                        'kombinasi': 1, 'silang homo': 1, '50 - 50': 1, 'tengah tepi': 1,
                        'kembang - kempis - kembar': 1, 'dasar ganjil - besar': 1,
                        'dasar genap - kecil': 1
                    };

                    if (min1000Games[t]) return true;

                    return /^colok bebas\s*\(\s*\d+\s*\)$/.test(t) ||
                           /^colok befas 2d\s*\(\s*\d+\s*\)$/.test(t) ||
                           /^colok befas 4d\s*\(\s*\d+\s*\)$/.test(t) ||
                           /^colok naga\s*\(\s*\d+\s*\)$/.test(t);
                };

                const tagOf = title => {
                    const t = norm(title);
                    if (t.indexOf('super diskon') === 0 || t.indexOf('diskon') === 0) return 'diskon';
                    if (t.indexOf('bet full') === 0) return 'betfull';
                    if (t.indexOf('prize') === 0) return 'prize';
                    if (t.indexOf('tepat') > -1 || /\bbb\b/.test(t)) return 'tepatbb';
                    return 'lain';
                };

                const prizeBlock = (p14, p13, p12, p24, p23, p22, p34, p33, p32) => ({
                    'PRIZE 1 - 4D': { hadiah: p14, diskon: 0 },
                    'PRIZE 1 - 3D': { hadiah: p13, diskon: 0 },
                    'PRIZE 1 - 2D': { hadiah: p12, diskon: 0 },
                    'PRIZE 2 - 4D': { hadiah: p24, diskon: 0 },
                    'PRIZE 2 - 3D': { hadiah: p23, diskon: 0 },
                    'PRIZE 2 - 2D': { hadiah: p22, diskon: 0 },
                    'PRIZE 3 - 4D': { hadiah: p34, diskon: 0 },
                    'PRIZE 3 - 3D': { hadiah: p33, diskon: 0 },
                    'PRIZE 3 - 2D': { hadiah: p32, diskon: 0 }
                });

                // Configuration storage
                const CFG = {};
                const cfg = (market, params) => {
                    CFG[market] = {
                        strict: true,
                        prizeAvailable: !!params.prize,
                        overrides: params.map || {}
                    };
                };

                cfg('HOKI DRAW', {
                    prize: false,
                    map: {
                        'DISKON 5D': { hadiah: 50000, diskon: 38 },
                        'DISKON 4D': { hadiah: 7000, diskon: 20 },
                        'DISKON 3D': { hadiah: 750, diskon: 20 },
                        'DISKON 2D': { hadiah: 75, diskon: 20 },
                        'BET FULL 5D': { hadiah: 88000 },
                        'BET FULL 4D': { hadiah: 10000 },
                        'BET FULL 3D': { hadiah: 1000 },
                        'BET FULL 2D': { hadiah: 100 },
                        '5D TEPAT': { hadiah: 50000 },
                        '5D BB': { hadiah: 350 },
                        '4D TEPAT': { hadiah: 5000 },
                        '4D BB': { hadiah: 180 },
                        '3D TEPAT': { hadiah: 500 },
                        '3D BB': { hadiah: 75 },
                        '2D TEPAT': { hadiah: 80 },
                        '2D BB': { hadiah: 15 },
                        'COLOK BEBAS': { hadiah: 0.9, diskon: 0 },
                        'COLOK BEBAS ( 2 )': { hadiah: 1.8, diskon: 0 },
                        'COLOK BEBAS ( 3 )': { hadiah: 2.7, diskon: 0 },
                        'COLOK BEBAS ( 4 )': { hadiah: 3.6, diskon: 0 },
                        'COLOK BEBAS ( 5 )': { hadiah: 4.5, diskon: 0 },
                        'COLOK JITU': { hadiah: 8 },
                        'COLOK BEBAS 2D ( 2 )': { hadiah: 4 },
                        'COLOK BEBAS 2D ( 3 )': { hadiah: 6 },
                        'COLOK BEBAS 2D ( 4 )': { hadiah: 20 },
                        'COLOK BEBAS 2D ( 5 )': { hadiah: 200 },
                        'COLOK BEBAS 4D ( 4 )': { hadiah: 50 },
                        'COLOK BEBAS 4D ( 5 )': { hadiah: 200 },
                        'COLOK NAGA ( 3 )': { hadiah: 12 },
                        'COLOK NAGA ( 4 )': { hadiah: 30 },
                        'COLOK NAGA ( 5 )': { hadiah: 125 },
                        'SHIO': { hadiah: 10 },
                        '50 - 50': { kei: -3 },
                        'KOMBINASI': { hadiah: 2.7 },
                        'TENGAH TEPI': { kei: -2.2 },
                        'DASAR GANJIL - BESAR': { kei: -25 },
                        'DASAR GENAP - KECIL': { kei: 10 }
                    }
                });

                // Standard markets configuration
                ['BANGKOK', 'BRUNEI', 'CHELSEA', 'HONGKONG', 'HUAHIN', 'MAGNUM4D', 'NEVADA', 'POIPET', 'SYDNEY', 'TOTO CAMBODIA', 'TOTOMALI', 'TOTO MACAU 4D', 'KINGKONG'].forEach(name => {
                    const base = {
                        'DISKON 4D': { hadiah: 3000, diskon: 66.5 },
                        'DISKON 3D': { hadiah: 400, diskon: 59.5 },
                        'DISKON 2D': { hadiah: 70, diskon: 29.5 },
                        'DISKON 2D DEPAN': { hadiah: 65, diskon: 29.5 },
                        'DISKON 2D TENGAH': { hadiah: 65, diskon: 29.5 },
                        'BET FULL 4D': { hadiah: 10000, diskon: 0 },
                        'BET FULL 3D': { hadiah: 1000, diskon: 0 },
                        'BET FULL 2D': { hadiah: 100, diskon: 0 },
                        '4D TEPAT': { hadiah: 4000 },
                        '4D BB': { hadiah: 200 },
                        '3D TEPAT': { hadiah: 400 },
                        '3D BB': { hadiah: 100 },
                        '2D TEPAT': { hadiah: 70 },
                        '2D BB': { hadiah: 20 },
                        'COLOK BEBAS': { hadiah: 1.5, diskon: 6 },
                        'COLOK BEBAS ( 2 )': { hadiah: 3, diskon: 6 },
                        'COLOK BEBAS ( 3 )': { hadiah: 4.5, diskon: 6 },
                        'COLOK BEBAS ( 4 )': { hadiah: 6, diskon: 6 },
                        'COLOK JITU': { hadiah: 8, diskon: 6 },
                        'COLOK BEBAS 2D ( 2 )': { hadiah: 7, diskon: 10 },
                        'COLOK BEBAS 2D ( 3 )': { hadiah: 11, diskon: 10 },
                        'COLOK BEBAS 2D ( 4 )': { hadiah: 18, diskon: 10 },
                        'COLOK NAGA ( 3 )': { hadiah: 23, diskon: 10 },
                        'COLOK NAGA ( 4 )': { hadiah: 35, diskon: 10 },
                        'SHIO': { hadiah: 9.5, diskon: 5 },
                        '50 - 50': { kei: -3, diskon: 2 },
                        'TENGAH TEPI': { kei: -3, diskon: 2 },
                        'SILANG HOMO': { kei: -3, diskon: 2 },
                        'KEMBANG - KEMPIS - KEMBAR': { kei: -3, diskon: 2 },
                        'KOMBINASI': { hadiah: 2.6, diskon: 8 },
                        'DASAR GANJIL - BESAR': { kei: -25, diskon: 2 },
                        'DASAR GENAP - KECIL': { kei: 10, diskon: 2 }
                    };
                    
                    if (name === 'KINGKONG' ) {
                        base['DISKON 4D'] = { hadiah: 6000, diskon: 33 };
                        base['DISKON 3D'] = { hadiah: 700, diskon: 24 };
                        base['DISKON 2D'] = { hadiah: 80, diskon: 15 };
                    }
                    
                    if (name === 'TOTOMALI') {
                        base['DISKON 4D'] = { hadiah: 3000, diskon: 67 };
                        base['DISKON 3D'] = { hadiah: 400, diskon: 57 };
                        base['DISKON 2D'] = { hadiah: 70, diskon: 27 };
                        delete base['DISKON 2D DEPAN'];
                        delete base['DISKON 2D TENGAH'];
                        base['COLOK BEBAS'] = { hadiah: 1.6, diskon: 6 };
                        base['COLOK BEBAS ( 2 )'] = { hadiah: 3.2, diskon: 6 };
                        base['COLOK BEBAS ( 3 )'] = { hadiah: 4.8, diskon: 6 };
                        base['COLOK BEBAS ( 4 )'] = { hadiah: 6.4, diskon: 6 };
                        base['COLOK JITU'] = { hadiah: 8.3, diskon: 6 };
                        base['COLOK BEBAS 2D ( 2 )'] = { hadiah: 7, diskon: 10 };
                        base['COLOK BEBAS 2D ( 3 )'] = { hadiah: 13, diskon: 10 };
                        base['COLOK BEBAS 2D ( 4 )'] = { hadiah: 21, diskon: 10 };
                        base['COLOK NAGA ( 3 )'] = { hadiah: 27, diskon: 10 };
                        base['COLOK NAGA ( 4 )'] = { hadiah: 41, diskon: 10 };
                        base['SHIO'] = { hadiah: 10, diskon: 5 };
                        base['50 - 50'] = { kei: -3, diskon: 2 };
                        base['TENGAH TEPI'] = { kei: -3, diskon: 2 };
                        base['SILANG HOMO'] = { kei: -3, diskon: 2 };
                        base['KEMBANG - KEMPIS - KEMBAR'] = { kei: -3, diskon: 2 };
                        base['KOMBINASI'] = { hadiah: 2.6, diskon: 8 };
                        base['DASAR GANJIL - BESAR'] = { kei: -25, diskon: 2 };
                        base['DASAR GENAP - KECIL'] = { kei: 10, diskon: 2 };
                    }

                    const prizeData = prizeBlock(6500, 650, 70, 2100, 210, 20, 1100, 110, 8);
                    cfg(name, { prize: true, map: Object.assign(base, prizeData) });
                });

                // US markets configuration
                ['BULLSEYE', 'CALIFORNIA', 'CAROLINA EVE', 'CAROLINA DAY', 'FLORIDA EVE', 'FLORIDA MID', 'KENTUCKY EVE', 'KENTUCKY MID', 'NEW YORK EVE', 'NEW YORK MID', 'OREGON', 'PCSO' ].forEach(name => {

                    const base = {
                        'DISKON 4D': { hadiah: 3000, diskon: 66.5 },
                        'DISKON 3D': { hadiah: 400, diskon: 59.5 },
                        'DISKON 2D': { hadiah: 70, diskon: 29.5 },
                        'DISKON 2D DEPAN': { hadiah: 65, diskon: 29.5 },
                        'DISKON 2D TENGAH': { hadiah: 65, diskon: 29.5 },
                        'BET FULL 4D': { hadiah: 10000, diskon: 0 },
                        'BET FULL 3D': { hadiah: 1000, diskon: 0 },
                        'BET FULL 2D': { hadiah: 100, diskon: 0 }
                    };

                    const others = {
                        'COLOK BEBAS': { hadiah: 1.5, diskon: 6 },
                        'COLOK BEBAS ( 2 )': { hadiah: 3, diskon: 6 },
                        'COLOK BEBAS ( 3 )': { hadiah: 4.5, diskon: 6 },
                        'COLOK BEBAS ( 4 )': { hadiah: 6, diskon: 6 },
                        'COLOK JITU': { hadiah: 8, diskon: 6 },
                        'COLOK BEBAS 2D ( 2 )': { hadiah: 7, diskon: 10 },
                        'COLOK BEBAS 2D ( 3 )': { hadiah: 11, diskon: 10 },
                        'COLOK BEBAS 2D ( 4 )': { hadiah: 18, diskon: 10 },
                        'COLOK NAGA ( 3 )': { hadiah: 23, diskon: 10 },
                        'COLOK NAGA ( 4 )': { hadiah: 35, diskon: 10 },
                        'SHIO': { hadiah: 9.5, diskon: 5 },
                        '50 - 50': { kei: -3, diskon: 2 },
                        'TENGAH TEPI': { kei: -3, diskon: 2 },
                        'SILANG HOMO': { kei: -3, diskon: 2 },
                        'KEMBANG - KEMPIS - KEMBAR': { kei: -3, diskon: 2 },
                        'KOMBINASI': { hadiah: 2.6, diskon: 8 },
                        'DASAR GANJIL - BESAR': { kei: -25, diskon: 2 },
                        'DASAR GENAP - KECIL': { kei: 10, diskon: 2 }
                    };

                    cfg(name, { prize: false, map: Object.assign(base, others) });
                });

                // Singapore special configuration
                cfg('SINGAPORE', {
                    prize: true,
                    map: (() => {
                        const base = {
                            'DISKON 4D': { hadiah: 3000, diskon: 66.5 },
                            'DISKON 3D': { hadiah: 400, diskon: 59.5 },
                            'DISKON 2D': { hadiah: 70, diskon: 29.5 },
                            'DISKON 2D DEPAN': { hadiah: 65, diskon: 29.5 },
                            'DISKON 2D TENGAH': { hadiah: 65, diskon: 29.5 },
                            'BET FULL 4D': { hadiah: 10000, diskon: 0 },
                            'BET FULL 3D': { hadiah: 1000, diskon: 0 },
                            'BET FULL 2D': { hadiah: 100, diskon: 0 },
                            '4D TEPAT': { hadiah: 4000 },
                            '4D BB': { hadiah: 200 },
                            '3D TEPAT': { hadiah: 400 },
                            '3D BB': { hadiah: 100 },
                            '2D TEPAT': { hadiah: 70 },
                            '2D BB': { hadiah: 20 },
                            'COLOK BEBAS': { hadiah: 1.5, diskon: 6 },
                            'COLOK BEBAS ( 2 )': { hadiah: 3, diskon: 6 },
                            'COLOK BEBAS ( 3 )': { hadiah: 4.5, diskon: 6 },
                            'COLOK BEBAS ( 4 )': { hadiah: 6, diskon: 6 },
                            'COLOK JITU': { hadiah: 8, diskon: 6 },
                            'COLOK BEBAS 2D ( 2 )': { hadiah: 7, diskon: 10 },
                            'COLOK BEBAS 2D ( 3 )': { hadiah: 11, diskon: 10 },
                            'COLOK BEBAS 2D ( 4 )': { hadiah: 18, diskon: 10 },
                            'COLOK NAGA ( 3 )': { hadiah: 23, diskon: 10 },
                            'COLOK NAGA ( 4 )': { hadiah: 35, diskon: 10 },
                            'SHIO': { hadiah: 9.5, diskon: 5 },
                            '50 - 50': { kei: -3, diskon: 2 },
                            'TENGAH TEPI': { kei: -3, diskon: 2 },
                            'SILANG HOMO': { kei: -3, diskon: 2 },
                            'KEMBANG - KEMPIS - KEMBAR': { kei: -3, diskon: 2 },
                            'KOMBINASI': { hadiah: 2.6, diskon: 8 },
                            'DASAR GANJIL - BESAR': { kei: -25, diskon: 2 },
                            'DASAR GENAP - KECIL': { kei: 10, diskon: 2 }
                        };
                        return Object.assign(base, prizeBlock(6500, 650, 70, 2100, 210, 20, 1100, 110, 8));
                    })()
                });

                // Main application logic
                let current = ''; // Always start with empty state
                let filter = 'all';

                const itemsFor = market => {
                    const config = CFG[market] || null;
                    if (!config) return { items: [], prize: false };

                    const items = [];
                    for (const key in config.overrides) {
                        if (!config.overrides.hasOwnProperty(key)) continue;
                        const override = config.overrides[key] || {};
                        items.push({
                            title: key,
                            hadiah: override.hadiah,
                            diskon: override.diskon,
                            kei: override.kei
                        });
                    }
                    return { items, prize: config.prizeAvailable };
                };

                const showEmpty = msg => {
                    empty.style.display = 'block';
                    empty.textContent = msg || 'Tidak ada data.';
                };

                const hideEmpty = () => {
                    empty.style.display = 'none';
                };

                // Card creation function
                function createCard(game) {
                    const title = norm(game.title);
                    const isKei = !!KEI_MINUS[title] || !!KEI_PLUS[title] || (game.kei != null);
                    const diskon = Number(game.diskon || 0);
                    const hadiah = Number(game.hadiah || 0);
                    const kei = isKei ? Number(game.kei || 0) : 0;

                    const card = document.createElement('div');
                    card.className = 'dhp-card';
                    card.dataset.tag = tagOf(game.title);

                    const h3 = document.createElement('h3');
                    h3.textContent = game.title + ' :';
                    if (norm((game.title || '').replace(/[-]/g, '-')) === 'kembang - kempis - kembar') {
                        h3.classList.add('dhp-small-title');
                    }

                    const meta = document.createElement('div');
                    meta.className = 'dhp-meta';
                    meta.textContent = isKei ?
                        ('Diskon : ' + (diskon || 0) + '% | Kei : ' + (kei >= 0 ? '+' : '') + (kei || 0) + '%') :
                        ('Diskon : ' + (diskon || 0) + '% | Hadiah : x' + (hadiah || '-'));

                    const row = document.createElement('div');
                    row.className = 'dhp-row';
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.setAttribute('inputmode', 'decimal');
                    input.placeholder = 'Input Nominal Taruhan';
                    input.min = '0';
                    input.step = 'any';
                    row.appendChild(input);

                    const actions = document.createElement('div');
                    actions.className = 'dhp-actions';
                    const btnHitung = document.createElement('button');
                    btnHitung.type = 'button';
                    btnHitung.className = 'dhp-btn dhp-hitung';
                    btnHitung.innerHTML = '<i class="fas fa-calculator"></i> HITUNG';
                    const btnReset = document.createElement('button');
                    btnReset.type = 'button';
                    btnReset.className = 'dhp-btn secondary dhp-reset';
                    btnReset.innerHTML = '<i class="fas fa-redo"></i> RESET';
                    actions.append(btnHitung, btnReset);

                    const output = document.createElement('div');
                    output.className = 'dhp-out';
                    const pillPay = document.createElement('div');
                    pillPay.className = 'dhp-pill dhp-pay';
                    pillPay.textContent = 'Jika anda melakukan bettingan pada ' + game.title + ' maka yang anda harus BAYAR : -';
                    const pillWin = document.createElement('div');
                    pillWin.className = 'dhp-pill dhp-win';
                    pillWin.textContent = 'Jika anda menang, maka anda akan di bayarkan : -';
                    const pillSum = document.createElement('div');
                    pillSum.className = 'dhp-pill dhp-sum';
                    pillSum.style.display = 'none';
                    pillSum.textContent = 'Total hadiah yang di dapatkan di tambah dengan modal awal : -';
                    const pillMin = document.createElement('div');
                    pillMin.className = 'dhp-pill dhp-min';
                    pillMin.style.display = 'none';
                    pillMin.textContent = 'MIN : -';
                    output.append(pillPay, pillWin, pillSum, pillMin);

                    // Create calculation table
                    const calcTable = document.createElement('div');
                    calcTable.className = 'card-calc-table';
                    const calcTitle = document.createElement('h4');
                    calcTitle.textContent = 'Cara Perhitungan:';
                    calcTable.appendChild(calcTitle);

                    // Create card structure
                    const cardHeader = document.createElement('div');
                    cardHeader.className = 'dhp-card-header';
                    cardHeader.append(h3, meta);

                    const cardContent = document.createElement('div');
                    cardContent.className = 'dhp-card-content';
                    cardContent.append(row, actions);

                    const cardFooter = document.createElement('div');
                    cardFooter.className = 'dhp-card-footer';
                    cardFooter.append(output, calcTable);

                    card.append(cardHeader, cardContent, cardFooter);

                    const showMin = value => {
                        output.classList.add('show');
                        pillMin.style.display = 'block';
                        pillMin.textContent = 'MIN : ' + idr(value);
                        pillPay.style.display = 'none';
                        pillWin.style.display = 'none';
                        pillSum.style.display = 'none';
                    };

                    const showResult = (bayar, menang, total, showTotal, calcSteps) => {
                        output.classList.add('show');
                        pillMin.style.display = 'none';
                        pillPay.style.display = 'block';
                        pillPay.textContent = 'Jika anda melakukan bettingan pada ' + game.title + ' maka yang anda harus BAYAR : ' + idr(bayar);
                        pillWin.style.display = 'block';
                        pillWin.textContent = 'Jika anda menang, maka anda akan di bayarkan : ' + idr(menang);
                        pillSum.style.display = showTotal ? 'block' : 'none';
                        pillSum.textContent = 'Total hadiah yang di dapatkan di tambah dengan modal awal : ' + idr(total);

                        // Show calculation steps
                        calcTable.innerHTML = '';
                        calcTitle.textContent = 'Cara Perhitungan:';
                        calcTable.appendChild(calcTitle);

                        if (calcSteps && calcSteps.length > 0) {
                            calcSteps.forEach(step => {
                                const stepDiv = document.createElement('div');
                                stepDiv.className = 'calc-step';
                                stepDiv.innerHTML = step;
                                calcTable.appendChild(stepDiv);
                            });
                            calcTable.classList.add('show');
                        }
                    };

                    btnHitung.addEventListener('click', () => {
                        const value = parseFloat(input.value);
                        const minValue = isMin1000(title) ? 1000 : 100;

                        if (isNaN(value) || value <= 0 || value < minValue) {
                            showMin(minValue);
                            showNotification('Masukkan nominal taruhan yang valid (minimal ' + idr(minValue) + ')', 'warning');
                            return;
                        }

                        let calcSteps = [];

                        if (isKei) {
                            const isMinus = /^(silang homo|50 - 50|tengah tepi|kembang - kempis - kembar|dasar ganjil - besar)$/i.test(title) ||
                                            (game.kei != null && game.kei < 0);
                            let bayar, menang, total;

                            if (isMinus) {
                                const pre = value + value * Math.abs(kei) / 100;
                                bayar = Math.ceil(pre * (1 - (diskon || 0) / 100));
                                menang = Math.round(value);

                                calcSteps = [
                                    '1. Modal awal: <span class="result">' + idr(value) + '</span>',
                                    '2. Tambah kei minus: <span class="formula">' + idr(value) + ' + ' + Math.abs(kei) + '% = ' + idr(pre) + '</span>',
                                    '3. Yang dibayar (setelah diskon): <span class="formula">' + idr(pre) + ' - ' + (diskon || 0) + '% = ' + idr(bayar) + '</span>',
                                    '4. Hadiah jika menang: <span class="result">' + idr(menang) + '</span>'
                                ];
                            } else {
                                bayar = Math.round(value * (1 - (diskon || 0) / 100));
                                menang = Math.round(value + value * ((kei || 0) / 100));

                                calcSteps = [
                                    '1. Modal awal: <span class="result">' + idr(value) + '</span>',
                                    '2. Yang dibayar (setelah diskon): <span class="formula">' + idr(value) + ' - ' + (diskon || 0) + '% = ' + idr(bayar) + '</span>',
                                    '3. Hadiah jika menang: <span class="formula">' + idr(value) + ' + ' + (kei || 0) + '% = ' + idr(menang) + '</span>'
                                ];
                            }

                            total = bayar + menang;
                            calcSteps.push('5. Total jika menang: <span class="result">' + idr(bayar) + ' + ' + idr(menang) + ' = ' + idr(total) + '</span>');
                            showResult(bayar, menang, total, true, calcSteps);
                        } else {
                            const bayar = Math.round(value * (1 - (diskon || 0) / 100));
                            const menang = Math.round(value * (hadiah || 0));
                            const total = bayar + menang;

                            calcSteps = [
                                '1. Modal awal: <span class="result">' + idr(value) + '</span>',
                                '2. Yang dibayar (setelah diskon): <span class="formula">' + idr(value) + ' - ' + (diskon || 0) + '% = ' + idr(bayar) + '</span>',
                                '3. Hadiah jika menang: <span class="formula">' + idr(value) + '  ' + (hadiah || 0) + ' = ' + idr(menang) + '</span>'
                            ];

                            if (isPlusTotal(game.title)) {
                                calcSteps.push('4. Total jika menang: <span class="result">' + idr(bayar) + ' + ' + idr(menang) + ' = ' + idr(total) + '</span>');
                            }

                            showResult(bayar, menang, total, isPlusTotal(game.title), calcSteps);
                        }
                        
                        showNotification('Perhitungan selesai!', 'success');
                    });

                    btnReset.addEventListener('click', () => {
                        input.value = '';
                        output.classList.remove('show');
                        calcTable.classList.remove('show');
                        showNotification('Input dan hasil telah direset', 'info');
                    });

                    // Allow Enter key to trigger calculation
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            btnHitung.click();
                        }
                    });

                    return card;
                }

                // Render function
                function render() {
                    if (!current) {
                        showEmpty('Silakan pilih pasaran di atas.');
                        grid.innerHTML = '';
                        info.innerHTML = '';
                        return;
                    }

                    hideEmpty();
                    info.setAttribute('data-market', current);
                    info.innerHTML = '';

                    const marketBox = document.createElement('div');
                    marketBox.className = 'market-box';

                    const logoURL = MARKET_LOGOS[current];
                    if (logoURL) {
                        const logo = document.createElement('img');
                        logo.src = logoURL;
                        logo.alt = current + ' logo';
                        logo.className = 'market-logo';
                        logo.loading = 'lazy';
                        marketBox.appendChild(logo);
                    } else {
                        const label = document.createElement('span');
                        label.textContent = current;
                        marketBox.appendChild(label);
                    }

                    info.appendChild(marketBox);

                    const data = itemsFor(current);
                    const items = data.items;
                    const hasPrize = data.prize;

                    const prizeTab = $('.dhp-tab[data-k="prize"]', wrap);
                    if (prizeTab) prizeTab.style.display = hasPrize ? '' : 'none';

                    const hasOther = items.some(game => tagOf(game.title) === 'lain');
                    const otherTab = $('.dhp-tab[data-k="lain"]', wrap);
                    if (otherTab) otherTab.style.display = hasOther ? '' : 'none';

                    let list = [];
                    items.forEach(game => {
                        const tag = tagOf(game.title);
                        if (filter !== 'all' && tag !== filter) return;
                        list.push({ g: game, tag: tag });
                    });

                    grid.innerHTML = '';

                    if (filter === 'all') {
                        const order = ['diskon', 'betfull', 'prize', 'tepatbb', 'lain'];
                        const titleMap = {
                            diskon: 'Diskon',
                            betfull: 'Bet Full',
                            prize: 'Prize 123',
                            tepatbb: 'Tepat & BB',
                            lain: 'Lainnya'
                        };

                        order.forEach(tag => {
                            const subList = list.filter(x => x.tag === tag);
                            if (!subList.length) return;

                            const divider = document.createElement('div');
                            divider.className = 'dhp-divider';
                            const label = document.createElement('span');
                            label.className = 'dhp-divider-label';
                            label.textContent = titleMap[tag];
                            divider.appendChild(label);
                            grid.appendChild(divider);

                            subList.forEach(x => grid.appendChild(createCard(x.g)));
                        });
                    } else {
                        list.forEach(x => grid.appendChild(createCard(x.g)));
                    }

                    if (!grid.children.length) {
                        showEmpty('Tidak ada kartu untuk ditampilkan.');
                    }
                }

                // Event listeners
                $$('.dhp-tab', wrap).forEach(button => {
                    button.addEventListener('click', () => {
                        $$('.dhp-tab', wrap).forEach(x => x.classList.remove('active'));
                        button.classList.add('active');
                        filter = button.dataset.k;
                        render();
                    });
                });

                sel.addEventListener('change', e => {
                    current = (e.target.value || '').toUpperCase();
                    safeStore.setItem('dhp_market', current);
                    render();
                    showNotification('Pasaran ' + current + ' dipilih', 'info');
                });

                sel.addEventListener('input', e => {
                    current = (e.target.value || '').toUpperCase();
                    safeStore.setItem('dhp_market', current);
                    render();
                });

                // Initialize with default state (closed)
                current = '';
                safeStore.removeItem('dhp_market');
                sel.value = '';

                // Reset to closed state on page load/refresh
                window.addEventListener('beforeunload', () => {
                    safeStore.removeItem('dhp_market');
                });

                render();

            } catch (err) {
                fatal(err && (err.message || err));
            }
        })();
    </script>
</body>
</html>
